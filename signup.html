<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/signup.css" />
</head>
<body>

   <div class="frame">
        <div class="card">

            <!-- LEFT IMAGE (same as login page) -->
            <div class="card-left">
                <div class="screen">
                    <img src="photo/girl.jpg" alt="Signup Illustration">
                </div>
            </div>

            <!-- RIGHT FORM -->
            <div class="card-right">
                <div class="brand">
                    <div class="brand-icon"></div>
                    <span class="brand-name">Team Dayag</span>
                </div>

                <h1>Create Account</h1>
                <p class="subtitle">Please fill in the details</p>

                <form onsubmit="return registerUser(event)">

                    <!-- EMAIL -->
                    <label>Email</label>
                    <input 
                        type="email"
                        id="email" 
                        required 
                        placeholder="Enter email"
                    >

                    <!-- PASSWORD -->
                    <label>Password</label>
                    <input 
                        type="password"
                        id="password" 
                        required 
                        placeholder="Enter password"
                    >

                    <!-- PASSWORD STRENGTH (IDs MATCH SCRIPT EXACTLY) -->
                    <div id="password-strength" class="password-rules">
                        <p id="len">❌ At least 8 characters</p>
                        <p id="upper">❌ At least 1 uppercase letter</p>
                        <p id="lower">❌ At least 1 lowercase letter</p>
                        <p id="num">❌ At least 1 number</p>
                    </div>

                    <!-- CONFIRM PASSWORD -->
                    <label>Confirm Password</label>
                    <input 
                        type="password"
                        id="confirmPassword"
                        required
                        placeholder="Confirm password"
                    >

                    <!-- BUTTON -->
                    <button type="submit" class="btn btn-primary">Sign Up</button>
                </form>

                <p class="login-link">
                    Already have an account? <a href="login.html">Login</a>
                </p>
            </div>

        </div>
    </div>


<!-- EmailJS SCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
    emailjs.init("yNq66TICQ0oH9auXD"); 
</script>

<!-- SWEETALERT2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script type="module">
import { auth } from "./firebase.js";

const passwordInput = document.getElementById("password");

// Strength check elements
const len = document.getElementById("len");
const upper = document.getElementById("upper");
const lower = document.getElementById("lower");
const num = document.getElementById("num");

// Live strength checker
passwordInput.addEventListener("input", () => {
    const value = passwordInput.value;

    len.textContent = value.length >= 8 ? "✅ At least 8 characters" : "❌ At least 8 characters";
    upper.textContent = /[A-Z]/.test(value) ? "✅ At least 1 uppercase letter" : "❌ At least 1 uppercase letter";
    lower.textContent = /[a-z]/.test(value) ? "✅ At least 1 lowercase letter" : "❌ At least 1 lowercase letter";
    num.textContent = /[0-9]/.test(value) ? "✅ At least 1 number" : "❌ At least 1 number";
});

async function registerUser(e) {
    e.preventDefault();

    let email = document.getElementById("email").value;
    let password = document.getElementById("password").value;
    let confirmPassword = document.getElementById("confirmPassword").value;

    // Password match check
    if (password !== confirmPassword) {
        Swal.fire({
            icon: "error",
            title: "Password Error",
            text: "Passwords do not match!",
        });
        return false;
    }

    // Password rule checks
    if (password.length < 8 || 
        !/[A-Z]/.test(password) ||
        !/[a-z]/.test(password) ||
        !/[0-9]/.test(password)) 
    {
        Swal.fire({
            icon: "warning",
            title: "Weak Password",
            text: "Password must include uppercase, lowercase, number, and be at least 8 characters.",
        });
        return false;
    }

    // Generate OTP
    let otp = Math.floor(100000 + Math.random() * 900000);

    // Store TEMPORARY user details
    localStorage.setItem("pendingEmail", email);
    localStorage.setItem("pendingPassword", password);
    localStorage.setItem("verificationOtp", otp);

    // Send OTP email (IMPORTANT: send isOtp:true)
    emailjs.send("service_drwa0hf", "template_6r8vr5l", {
        to_email: email,
        otp_code: otp,
        isOtp: "true"
    });

    Swal.fire({
        icon: "success",
        title: "OTP Sent!",
        html: `We sent a verification code to your email.<br>
               Please check your inbox or spam folder.`,
        confirmButtonText: "Go to Verification",
    }).then(() => {
        window.location.href = "otp.html";
    });
}

window.registerUser = registerUser;
</script>

</body>
</html>
